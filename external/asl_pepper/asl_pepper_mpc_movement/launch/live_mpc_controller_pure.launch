<?xml version="1.0"?>
<launch>

  <arg name="mapname" default="asl_office_j" />
  <arg name="mapfolder" default="$(env HOME)/maps"/>
  <arg name="ia_downsampling_passes" default="1"/>
<!--   <arg name="localization" default="false"/>  -->   <!-- if disabled uses g.t. loc from sim -->

  <arg name="scenario" default="unitytest"/>
  <arg name="max_runtime" default="300" />
  <arg name="script_args" default="--hz"/>
  <arg name="n_downsampling_passes" default="3"/>
  <arg name="localization" default="true"/>

  <!--   <arg name="is_simulation" default="$(eval 'simulator' in arg('rosbag') or 'multiagent_sim' in arg('rosbag'))"/>-->  
  <arg name="is_simulation" default="true"/>
  <arg name="rviz" default="true"/>
  <arg name="dr_spaam_start" default="true"/>

  <!-- Gmapping & Map Matching -->
  <include file="$(find asl_pepper_gmapping)/launch/gmapping.launch" if="$(arg localization)">
    <arg name="output" value="log"/>
  </include>
  <include file="$(find map_matcher)/launch/map_matcher.launch" if="$(arg localization)">
    <arg name="output" value="log" />
    <arg name="slam_map_topic" value="/gmap"/>
    <arg name="reference_map_name" value="$(arg mapname)"/>
    <arg name="maps_folder" value="$(arg mapfolder)"/>
    <arg name="launch_prefix" value="nice -n 20" />
  </include>
  <!-- Otherwise just publish reference map -->
  <node pkg="map_server" type="map_server" name="ref_map_server"
    args="$(arg mapfolder)/$(arg mapname).yaml" if="$(eval arg('localization') != true)">
    <param name="frame_id" value="reference_map" />
    <remap from="/map" to="/reference_map"/>
  </node>

  <!-- Global Path Planning -->
  <node pkg="asl_pepper_motion_planning" type="global_planner"
    name="global_planner" args="--hz" output="log" >
    <param name="reference_map_name" value="$(arg mapname)"/>
    <param name="reference_map_folder" value="$(arg mapfolder)"/>
    <param name="reference_map_downsampling_passes" value="$(arg n_downsampling_passes)" />
  </node>

  <!-- MPC Planner -->
  <node pkg="asl_pepper_mpc_movement" type="asl_pepper_mpc_movement" name="mpc_movement" output="screen"
    args="$(arg script_args)">
    <rosparam command="load" file="$(find asl_pepper_mpc_movement)/config/controller_params.yaml"/>
  </node>

  <!-- Local RVIZ -->
  <node type="rviz" name="rviz" pkg="rviz" args="-d $(env HOME)/.rviz/rvo.rviz" 
    if="$(arg rviz)">
  </node>

  <!-- Panel with sliders for the weights etc. -->
  <!-- TODO: Open it up already, to see sliders directly -->
  <node name="rqt_reconfigure" pkg="rqt_reconfigure" type="rqt_reconfigure"
    >
  </node>

  <!-- Detecting agents/people, strat for the live script. -->
<!--   <node pkg="dr_spaam_ros" type="node.py" name="dr_spaam_ros" output="screen">
    <rosparam command="load" file="$(find dr_spaam_ros)/config/dr_spaam_ros.yaml"/>
    <rosparam command="load" file="$(find dr_spaam_ros)/config/topics.yaml"/>
  </node> -->
  <node pkg="dr_spaam_ros" type="node.py" name="dr_spaam_ros" output="screen"
    if="$(arg dr_spaam_start)">
    <rosparam command="load" file="$(find asl_pepper_mpc_movement)/config/dr_spaam_ros.yaml"/>
    <rosparam command="load" file="$(find asl_pepper_mpc_movement)/config/dr_spaam_topics.yaml"/>
  </node>

</launch>




